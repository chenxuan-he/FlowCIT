# Codes for Conditional Independence Test by Conditional Flow Models

## Reproduction guide

-   Each bash file contains command lines to reproduce results of one scenario.
    -   For instance: **model1_1_n500.sh** reproduce the results of model 1, scenario 1, with sample size $n=500$.
    -   It first generates data and store at the *data/* folder, e.g.,
        ```bash
        nohup python model_generate_data.py --model=1 --sim_type=1 --alpha=.00 --nsim=200 --d=3 --p=3 --q=3 --n=500
    -   It then run `Rscript model_CLZ.R`

## Explanations for the files

-   Files with prefix *functions_*
    -   **functions_generate_data.py**
        -   The main code to generate data and write out the folder *data/*. The python and R codes then read the data back.
    -   **functions_generate_data.R**
        -   Read the data generated by functions_generate_data.py.
    -   **functions_gcit.py**
        -   Code adapted from: https://github.com/vanderschaarlab/mlforhealthlabpub/tree/main/alg/gcit
        -   We revised the code to make the splitting proportion (training/test ratio) as an input to maintain size under $H_0$. For each set of simulation, the ratio is then fixed.
    -   **functions_flow.py**
        -   The main code to implement a continuous normalizing flow training as proposed by us.
    -   **functions_test.py**
        -   The code to implement tests, including the permutation test proposed by us, the FCIT test, and the CDC test.

-   Files with prefix *model_*
    -   **model_CLZ.R** and **model_CLZ_result.R**
        -   Perform the CLZ test and the KCI test, and then read the result back to output the empirical size and power.
        -   Similar to GCIT test, the bandwidth of CLZ test is tuned to maintain the size under $H_0$ and then fixed for $H_1$.
    -   **model_GCIT.py**
        -   A separate file to implement the GCIT test. Note that it requires tensorflow version at 1.13.1.
    -   **model_generate_data.py**
        -   Call the functions from **functions_generate_data.py** to generate data.
    -   **model_result.py** and **model_plot.py**
        -   Get the results implemented by python, and plot by matplotlib.
    -   **model.py**
        -   The main code to implement FlowCIT, FCIT, and CDC tests.

-   Folders
    -   *CLZ/*
        -   The folder contains some necessary codes and intermediate files to implement the CLZ test.
    -   *data/*
        -   Intermediate folder to store the data generated by **model_generate_data.py**.
    -   *plots/*
        -   Store the plots generated by **model_plot.py**
    -   *results/*
        -   Intermediate folder to store the results outputed by **model_GCIT.py** and **model.py**